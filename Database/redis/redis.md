# Redis (Remote Dictionary Server)

RDBMS(Relational Database Management System)를 사용하면서, 대용량, 비정형 데이터 저장 및 빠른 응답 시간 등의 요구사항을 대응하기 어려울때가 있다. 이때 RDBMS와는 차별적인 특징을 갖는 NoSQL을 사용하게 되는데, NoSQL은 데이터 저장 방식에 따라 Graph store, Column store, Document store, Key-Value store가 있다. Redis는 가장 인기있는 Key-Value Store 중 하나이다.

## 사용하는 이유

Redis를 사용하는 이유 중 하나는 빠르게 결과값을 찾을 수 있다는 점이다. 데이터베이스는 데이터를 물리 디스크에 직접 쓰기 때문에 서버에 문제가 발생하더라도 데이터가 손실되지 않는다. 하지만 매번 디스크에 접근해야하므로 요청이 많아질수록 부하가 걸려 느려진다. 이때 캐시서버를 도입할 수 있는데, 캐시 서버로 사용할 수 있는 것이 바로 Redis이다.

캐시는 한 번 읽어온 데이터를 임의의 공간에 저장해 다음에 읽을때 더 빠르게 결과값을 받을 수 있도록 도와주는 공간이다. 같은 요청이 여러번 들어오는 경우 매번 데이터베이스를 거치는 것이 아니라 캐시 서버에서 첫 번쨰 요청 이후 저장된 결과값을 바로 내려주기 때문에 DB 부하를 줄여주고 서비스의 속도를 느려지지 않게 한다.

## 특징

- key, value 구조이기 때문에 쿼리를 사용할 필요가 없다.
- 데이터를 디스크에 쓰는 구조가 아니라 메모리에 데이터를 저장하므로 속도가 빠르다.
- string, list, set, sorted sets, hash 자료구조를 지원한다.
- single thread이다. 한 번에 하나의 명령어만 처리할 수 있고, 처리 시간이 긴 명령어가 들어오면 그 뒤의 명령어는 대기한다. 하지만 get, set 명령어는 초당 10만개 이상을 처리할 수 있을만큼 빠르다.
- 읽기 성능 증대를 위한 서버 측 복제를 지원한다.
- 쓰기성능 증대를 위한 클라이언트 측 샤딩을 지원한다.
- 인메모리 데이터 저장소의 특성상 서버에 장애가 발생했을때 데이터가 유실될 수 있으므로 그에 대한 운영 플랜이 필요하다.

## 활용

- 캐싱

  - 캐시란, 결과를 미리 저장해둔 뒤 요청이 들어왔을때, 빠르게 서비스하는 것을 의미한다. 클라이언트는 레디스(캐시 서버)를 먼저 조회해서 데이터를 찾은 경우(캐시 히트) 빠르게 응답을 리턴하고, 데이터를 찾지 못한 경우(캐시 미스) 데이터베이스를 조회하게 된다.

  - 레디스는 데이터 캐싱에 적합한 데이터 저장소이다.레디스를 이용한 캐싱은 불필요한 DB 쿼리를 줄이고 빠른 응답 속도를 제공할 수 있다.

  - 캐시 전략으로는 look aside cache와 write back이 있다. look aside cache는 캐시를 접근해 데이터가 있는지 조회하고, 있으면 캐시 데이터를 사용하고 없다면 DB를 호출한다. write back은 데이터를 캐시에 저장하고, 캐시에 있는 데이터를 일정 기간동안 체크한다. 모여있는 데이터를 DB에 저장하고 캐시에 있는 데이터를 삭제한다.

- 세션 저장

  레디스는 세션 데이터 저장에 적합하다. 세션은 웹 어플리케이션에서 사용자 상태를 유지하기 위한 방법이다. 레디스를 이용해 세션 데이터를 저장하면, 다수의 서버에서 액세스할 수 있는 세션 데이터를 공유할 수 있으므로 애플리케이션의 확장성을 높일 수 있다.

- 토큰 저장

  토큰은 보안 인증 시스템에서 사용되며, 인증된 사용자를 구별하고 유효성을 검증하는데 사용된다. 레디스를 이용해 토큰을 저장하면 다수의 서버에서 토큰 데이터를 공유하고 보안성을 높일 수 있다.

- 메시지 큐

  레디스는 메시지 큐 역할을 수행할 수 있다. 메시지 큐는 비동기적인 메시지 처리를 지원하는 소프트웨어 패턴으로, publisher와 receiver 간의 통신을 통해 데이터를 처리한다. 레디스는 Pub/Sub 기능을 이용해 다수 클라이언트 간의 실시간 메시지 전달을 지원할 수 있다.

## 영속성

Redis는 영속성을 보장하기 위해 데이터를 디스크에 저장할 수 있다. 서버가 다운되더라도 디스크에 저장된 데이터를 읽어 메모리에 로딩한다. 이렇게 데이터를 디스크에 저장하는 방식은 다음 두가지이다.

- RDB (Snapshot)
  메모리에 있는 내용 전체를 스냅샷 찍어 디스크에 옮겨담는 방식

- AOF (Append On File)
  Redis의 모든 write/update 연산 자체를 모두 log 파일에 기록하는 방식

<br><br>

> ### reference

- <a href="https://redis.io/docs/management/persistence/">레디스 영속성</a>
- <a href="https://devmoony.tistory.com/173">레디스 특징과 활용</a>
- <a href="https://sabarada.tistory.com/103">캐시와 레디스</a>
